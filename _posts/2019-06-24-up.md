---
layout: post
title: å¦‚ä½•åˆ©ç”¨MySQLæ•°æ®åº“åˆ¶ä½œä¸€ä¸ªå›¾ç«™
tags: [MySQL, æ•°æ®åº“, å›¾ç«™, PHP]
--- 

æœ€è¿‘ç™½å«–äº†ä¸€ä¸ª500GBçš„æ•°æ®åº“ï¼Œæƒ³æƒ³æ€ä¹ˆåˆ©ç”¨ä¸€ä¸‹ï¼Ÿ<!--more-->    

# Talk is cheap,show me the code

  æ•°æ®åº“å»ºè¡¨ï¼š
```
CREATE TABLE `FileUP` (
 `ID` int(11) NOT NULL AUTO_INCREMENT,
 `Name` text NOT NULL,
 `File` blob NOT NULL,
 `Size` int(11) NOT NULL,
 PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=gb2312; 
```

  PHPä»£ç ï¼š
```
<?php
$con=mysqli_connect("æ•°æ®åº“åœ°å€","ç”¨æˆ·å","å¯†ç ","æ•°æ®åº“å"); 
if (mysqli_connect_errno($con)) 
{ 
    die("è¿æ¥ MySQL å¤±è´¥: " . mysqli_connect_error()); 
}

if ( $_GET[ID] != '' ) {
    header('Access-Control-Allow-Origin: *');
    $sql = "SELECT * FROM `FileUP` WHERE `ID` = '".addslashes($_GET[ID])."' ";
    $result = $con->query($sql);
    if ($result->num_rows > 0) {
        while($row = $result->fetch_assoc()){ 
         Header ( "Content-type: application/octet-stream" ); 
         Header ( "Accept-Ranges: bytes" ); 
         Header ( "Accept-Length: " . $row["Size"] ); 
         Header ( "Content-Disposition: attachment; filename=" . $row["Name"] );
        echo $row["File"];
    }
} 
    else {
 header('HTTP/1.1 404 NOT FOUND'); 
}
} else {
echo '<title>Mayxå›¾åºŠ</title>
<h1>Mayxå›¾åºŠ</h1><hr>
è¯·é€‰æ‹©éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆå¤§å°ä¸å¾—è¶…è¿‡16MiBï¼‰
<form enctype="multipart/form-data" method="post" action="">
  <input type="file" name="File" />
  <input type="submit" name="submit" value="submit" />
</form>
<br />';
if ( $_SERVER['REQUEST_METHOD'] == "POST" ) {
 $error = $_FILES['File']['error'];
 $tmp_name = $_FILES['File']['tmp_name'];
 $size = $_FILES['File']['size'];
 $name = $_FILES['File']['name'];
 print("\n");
 if ($error == UPLOAD_ERR_OK && $size > 0) {
  $fp = fopen($tmp_name, 'r');
  $content = fread($fp, $size);
  fclose($fp);  
  $content = addslashes($content);
  $sql = "INSERT INTO `FileUP` (`Name`, `File`, `Size`)
 VALUES ('".$name."', '".$content."', '".$size."');";
  $con->query($sql);
  $sql = "select @@identity;";
  $result = $con->query($sql);
while($row = $result->fetch_assoc()) {
echo 'ä¸Šä¼ å®Œæˆï¼Œæ–‡ä»¶ä¸‹è½½åœ°å€ï¼š<a href="//'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']."?ID=".$row['@@identity'].'" >'.$_SERVER['HTTP_X_FORWARDED_PROTO'].'://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']."?ID=".$row['@@identity'].'</a>';
}

 } else {
  echo "æ–‡ä»¶ä¸Šä¼ é”™è¯¯ï¼";
 }

}

echo '<hr />
<center><a href="https://mabbs.github.io/">By Mayx</a></center>';

}

mysqli_close($con);
```

# ç¼ºç‚¹
  MySQLä¿å­˜æ–‡ä»¶æœ‰é™åˆ¶ï¼Œå¥½åƒåªèƒ½å­˜16MBå·¦å³ğŸ˜“

# æ¼”ç¤ºï¼ˆéšæ—¶GGï¼‰
<https://mayx.leanapp.cn/up.php>
